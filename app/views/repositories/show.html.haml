-# app/views/repositories/show.html.haml
-# This view is used to render the left repo detail panel (repo_show frame).

- repository = @repository
- return if repository.nil?

- inner = capture do
  %div{ class: "p-3 flex-1 overflow-y-auto" }
    %div{ class: "rounded-2xl border border-indigo-200 bg-white shadow-sm overflow-hidden" }
      %div{ class: "bg-indigo-50 px-4 py-3 flex items-start justify-between gap-3" }
        %div{ class: "min-w-0" }
          %div{ class: "text-sm font-semibold text-gray-900 truncate" }
            = "#{repository.name.presence || '—'}"

          %div{ class: "mt-1 text-xs text-gray-600 font-mono truncate" }
            %span{ class: "text-gray-800" }
              = repository.current_snapshot&.commit_sha || "N/A"

        %div{ class: "shrink-0 flex items-center gap-2" }
          = link_to "Setting",
            edit_repository_path(repository, repository_id: repository.id),
            data: { turbo_frame: "repo_right" },
            class: "button-secondary"

      %div{ class: "px-4 py-4 space-y-4" }
        %div{ class: "rounded-xl border border-indigo-100 bg-gray-50 px-3 py-2" }
          %span{ class: "text-xs font-semibold text-gray-700" } Files
          %span{ class: "mt-1 text-sm font-mono text-gray-900" }
            = link_to (@file_count || 0),
              repository_files_path(repository_id: repository.id, path_filter: @path_filter.to_s),
              class: "underline",
              data: { turbo_frame: "repo_right" }

        %div{ class: "rounded-xl border border-indigo-100 bg-gray-50 px-3 py-2" }
          %span{ class: "text-xs font-semibold text-gray-700" } Scan Runs
          %span{ class: "mt-1 text-sm font-mono text-gray-900" }
            = link_to (@scan_count || 0),
              scan_runs_path(repository_id: repository.id),
              class: "underline",
              data: { turbo_frame: "repo_right" }

        %div{ class: "space-y-1" }
          %div{ class: "text-xs font-semibold text-gray-700" } Root Path
          %div{ class: "rounded-xl border border-indigo-100 bg-gray-50 px-3 py-2 text-sm font-mono text-gray-900 break-all" }
            = repository.root_path.presence || "—"

        %div{ class: "space-y-1" }
          %div{ class: "text-xs font-semibold text-gray-700" } Permitted extensions
          %div{ class: "rounded-xl border border-indigo-100 bg-gray-50 px-3 py-2 text-sm font-mono text-gray-900 break-words" }
            = repository.permitted_ext.presence || "—"

        %div{ class: "mt-3 text-xs text-gray-500" }
          Select another repository from the dropdown above to view its details.

- if turbo_frame_request?
  = turbo_frame_tag "repo_show" do
    = inner
- else
  = inner