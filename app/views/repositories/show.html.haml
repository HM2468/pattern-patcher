-# app/views/repositories/show.html.haml
-# Left repo detail panel (repo_show frame). Style aligned with _repo_dropdown.html.haml.
-# css config located in: app/assets/stylesheets/repository-show.css

- repository = @repository
- return if repository.nil?

- inner = capture do
  %div{ class: "flex-1 overflow-y-auto" }
    %div{ class: "rounded-2xl border border-indigo-200 bg-white shadow-sm overflow-hidden" }
      -# Header
      %div{ class: "bg-indigo-100 px-4 py-3 flex items-start justify-between gap-3" }
        %div{ class: "min-w-0" }
          %div{ class: "text-sm font-semibold text-gray-900 truncate" }
            = repository.name.presence || "—"

          %div{ class: "mt-1 text-xs text-gray-600 font-mono truncate" }
            = repository.current_snapshot&.commit_sha || "N/A"

        %div{ class: "shrink-0 flex items-center gap-2" }
          = link_to edit_repository_path(repository, repository_id: repository.id),
            class: "icon-button",
            data: { turbo_frame: "repo_right", controller: "tooltip", tooltip_text_value: "Repository setting", tooltip_placement_value: "bottom" } do
            = svg_icon("cog-6-tooth", class_name: "w-6 h-6")

      -# Body
      %div{ class: "px-2 py-2 space-y-2" }
        -# Stats cards
        %div{ class: "grid grid-cols-2 gap-2" }
          = link_to repository_files_path(repository_id: repository.id, path_filter: @path_filter.to_s),
            data: { turbo_frame: "repo_right" },
            class: "repo-stat-card" do
            %div.repo-stat-label Files
            %div.repo-stat-value
              = (@file_count || 0)

          = link_to scan_runs_path(repository_id: repository.id),
            data: { turbo_frame: "repo_right" },
            class: "repo-stat-card" do
            %div.repo-stat-label Scans
            %div.repo-stat-value
              = (@scan_count || 0)

        -# Root Path
        - root_path_text = repository.root_path.presence || "—"
        %div.repo-meta-block
          %div.repo-meta-label Root Path
          %div.repo-meta-value{ title: root_path_text }
            = root_path_text

        -# Permitted extensions
        - permitted_text = repository.permitted_ext.presence || "—"
        %div.repo-meta-block
          %div.repo-meta-label Permitted ext
          %div.repo-meta-value{ title: permitted_text }
            = permitted_text

- if turbo_frame_request?
  = turbo_frame_tag "repo_show" do
    = inner
- else
  = inner