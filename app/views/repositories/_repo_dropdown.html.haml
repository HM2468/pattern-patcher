-# app/views/repositories/_repo_dropdown.html.haml

%div{ class: "rounded-2xl bg-indigo-100 p-3 flex items-center justify-between" }
  %div
    %h1{ class: "text-xl font-semibold" } Repositories
  %div
    = link_to new_repository_path,
      class: "inline-flex items-center justify-center p-2 rounded-lg text-indigo-700 hover:bg-indigo-100",
      title: "New Repository" do
      %svg{ xmlns: "http://www.w3.org/2000/svg", class: "w-5 h-5", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor" }
        %path{ "stroke-linecap":"round", "stroke-linejoin":"round", "stroke-width":"2", d: "M12 4v16m8-8H4" }

- if @repositories.nil? || @repositories.empty?
  %div{ class: "p-3" }
    %div{ class: "font-semibold mb-2" } No repositories yet
    %div{ class: "text-sm text-gray-700 mb-4" }
      Create one to import files from a local folder.
- else
  %div{ class: "p-3 border-b border-gray-200" }
    %label{ class: "block text-xs font-semibold text-gray-700 mb-2" }
      Select a repository

    - selected_id = @selected_id || @repositories.first.id

    %div{
      data: {
        controller: "repo-switcher",
        repo_switcher_show_frame_id_value: "repo_right",
        repo_switcher_files_frame_id_value: "repo_right",
        repo_switcher_show_url_template_value: "/repositories/__ID__",
        repo_switcher_files_url_template_value: "/repository_files?repository_id=__ID__&path_filter=#{CGI.escape(@path_filter.to_s)}"
      }
    }
      = select_tag :repository_id,
          options_for_select(@dropdown_list.map { |r| [r[:name], r[:id]] }, selected_id),
          class: "dropdown-select",
          data: { action: "change->repo-switcher#change" }