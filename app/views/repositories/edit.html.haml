-# app/views/repositories/edit.html.haml

- inner = capture do
  %div.max-w-5xl.mx-auto.p-6.space-y-10
    / ===== Header & form =====
    %div.space-y-3
      %div.flex.items-start.justify-between.gap-4
        %div
          %div.font-semibold.text-lg
            #{@repository.name}
          %div.text-sm.text-gray-600.font-mono.mt-1
            Last scan version: #{@repository.current_snapshot&.commit_sha || "N/A"}

      = render "repositories/form"

    / ===== Actions: side-by-side =====
    %div.grid.grid-cols-1.gap-6.md:grid-cols-2.items-stretch
      / ----- Reimport -----
      %div.rounded-xl.border.border-indigo-200.bg-white.p-5.shadow-sm.flex.flex-col.space-y-3
        %div.font-semibold
          Reimport files

        %div.text-sm.text-gray-600
          Reimport all permitted files from the repository root path.
          Existing files will be updated; new files will be added.

        / button pinned to bottom
        %div.flex.justify-end.pt-3.mt-auto
          = button_to "Import",
            import_repository_path(@repository),
            method: :get,
            onclick: "return window.PopConfirmLog.open(event, this)",
            data: @confirm_message[:import],
            class: "button-secondary",
            form: { data: { turbo_frame: "_top" } }

      / ----- Delete -----
      %div.rounded-xl.border.border-red-200.bg-white.p-5.shadow-sm.flex.flex-col.space-y-3
        %div.font-semibold.text-red-600
          Delete repository

        %div.text-sm.text-gray-600
          Delete this repository and all its files as well as lexemes and reviews
          associated with them from the system.
          %span.font-semibold.text-red-600
            This action is irreversible.

        / button pinned to bottom
        %div.flex.justify-end.pt-3.mt-auto
          = button_to "Delete",
            repository_path(@repository),
            method: :delete,
            onclick: "return window.PopConfirmLog.open(event, this)",
            data: @confirm_message[:delete],
            class: "button-danger",
            form: { data: { turbo_frame: "_top" } }

    / ===== Footer =====
    %div.flex.justify-end.pt-2
      = link_to "Back",
        repositories_path(repository_id: @repository.id),
        class: "button-secondary",
        data: { turbo_frame: "repo_right" }

- if turbo_frame_request?
  = turbo_frame_tag "repo_right" do
    = inner
- else
  = inner