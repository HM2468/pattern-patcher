-# app/views/repositories/_repo_list.html.haml

%div{ class: "bg-indigo-100 p-3 flex items-center justify-between" }
  %div
    %h1{ class: "text-xl font-semibold" } Repositories
  %div
    = link_to "New Repo", new_repository_path, class: "button-primary"

- if @repositories.empty?
  %div{ class: "p-3" }
    %div{ class: "font-semibold mb-2" } No repositories yet
    %div{ class: "text-sm text-gray-700 mb-4" }
      Create one to import files from a local folder.

- else
  %div{ class: "flex-grow overflow-y-auto" }
    %table{ class: "w-full text-sm table-fixed" }
      %tbody{ class: "divide-y divide-gray-300" }
        - current_id = @repository&.id

        - @repositories.each do |repo|
          - active = (current_id.present? && repo.id == current_id)

          %tr{ class: "hover:bg-gray-50/70 transition #{active ? 'bg-gray-50' : ''}" }
            -# Column 1: clickable area (select repo)
            %td{ class: "px-3 py-3" }
              = link_to repositories_path(repository_id: repo.id), class: "block w-full" do
                %div{ class: "flex items-center gap-3" }

                  -# Icon: active repo uses "open folder", others use "closed folder"
                  %div{ class: "w-10 h-10 rounded-lg bg-white flex items-center justify-center shrink-0 text-gray-700" }
                    - if active
                      -# Open folder icon
                      %svg{ width: "40", height: "40", viewBox: "0 0 24 24", fill: "none", xmlns: "http://www.w3.org/2000/svg" }
                        %path{ d: "M3 7a2 2 0 0 1 2-2h4l2 2h6a2 2 0 0 1 2 2v1H7.5a2 2 0 0 0-1.8 1.1L3 16V7z", stroke: "currentColor", stroke_width: "1.6", stroke_linejoin: "round" }
                        %path{ d: "M4.2 16.6 6.2 12.6A2 2 0 0 1 8 11.5h12.3a1.2 1.2 0 0 1 1.07 1.75l-1.65 3.3A2 2 0 0 1 18.95 18H5.3a1.2 1.2 0 0 1-1.1-1.4z", stroke: "currentColor", stroke_width: "1.6", stroke_linejoin: "round" }
                    - else
                      -# Closed folder icon
                      %svg{ width: "40", height: "40", viewBox: "0 0 24 24", fill: "none", xmlns: "http://www.w3.org/2000/svg" }
                        %path{ d: "M3 6a2 2 0 0 1 2-2h5l2 2h7a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6z", stroke: "currentColor", stroke_width: "1.6", stroke_linejoin: "round" }

                  %div{ class: "min-w-0 flex-1" }
                    %div{ class: "font-semibold text-sm truncate text-gray-900" }= repo.name

            -# Column 2: edit button area (independent click target)
            %td{ class: "px-3 py-3 w-24 text-right align-middle" }
              = link_to "Setting", edit_repository_path(repo), class: "button-secondary"