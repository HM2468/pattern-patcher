
/ Intro
%section{ class: "space-y-2" }
  %h2{ class: "text-2xl font-semibold tracking-tight" } Controlled, interruptible scans for legacy codebases
  %p{ class: "text-gray-600 max-w-3xl" }
    PatternPatcher does not run a one-shot full scan. It executes patterns in priority order, producing auditable occurrences that can be reviewed and applied safely.

/ KPI cards
%section{ class: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" }
  -# Replace these numbers with real counts later.
  .rounded-2xl.border.bg-white.p-5.shadow-sm
    .text-xs.font-medium.text-gray-500 Enabled patterns
    .mt-2.flex.items-end.justify-between
      .text-3xl.font-semibold 12
      .text-xs.text-gray-500 Priority-ordered

  .rounded-2xl.border.bg-white.p-5.shadow-sm
    .text-xs.font-medium.text-gray-500 Active repositories
    .mt-2.flex.items-end.justify-between
      .text-3xl.font-semibold 3
      .text-xs.text-gray-500 Local paths

  .rounded-2xl.border.bg-white.p-5.shadow-sm
    .text-xs.font-medium.text-gray-500 Unreviewed occurrences
    .mt-2.flex.items-end.justify-between
      .text-3xl.font-semibold 148
      .text-xs.text-amber-700.bg-amber-50.border.border-amber-200.px-2.py-1.rounded-lg Needs review

  .rounded-2xl.border.bg-white.p-5.shadow-sm
    .text-xs.font-medium.text-gray-500 Applied actions (7d)
    .mt-2.flex.items-end.justify-between
      .text-3xl.font-semibold 27
      .text-xs.text-green-700.bg-green-50.border.border-green-200.px-2.py-1.rounded-lg Safe changes

-# Primary workflow cards
%section{ class: "grid grid-cols-1 lg:grid-cols-3 gap-4" }
  .rounded-2xl.border.bg-white.p-6.shadow-sm.space-y-4
    %div{ class: "flex items-start justify-between" }
      %div
        %h3{ class: "text-lg font-semibold" } 1) Match (Regex Based Search)
        %br
        %p{ class: "text-sm text-gray-600" }
          Find candidate code fragments using prioritized lexical patterns.

    %ul{ class: "text-sm text-gray-700 space-y-2" }
      %li.flex.gap-2
        %span{ class: "mt-1 h-2 w-2 rounded-full bg-gray-300 inline-block" }
        %span Select a single pattern (priority-gated)
      %li.flex.gap-2
        %span{ class: "mt-1 h-2 w-2 rounded-full bg-gray-300 inline-block" }
        %span Scan imported files per run (line-by-line)
      %li.flex.gap-2
        %span{ class: "mt-1 h-2 w-2 rounded-full bg-gray-300 inline-block" }
        %span Produce lexemes and occurrences for audit

    %div{ class: "flex gap-2" }
      %a{ href: "#", class: "inline-flex items-center rounded-xl bg-gray-900 px-4 py-2 text-sm font-medium text-white hover:bg-black" } Run Scan
      %a{ href: "#", class: "inline-flex items-center rounded-xl border px-4 py-2 text-sm hover:bg-gray-50" } Matched Lexemes

  .rounded-2xl.border.bg-white.p-6.shadow-sm.space-y-4
    %div{ class: "flex items-start justify-between" }
      %div
        %h3{ class: "text-lg font-semibold" } 2) Process (Automated Transform)
        %br
        %p{ class: "text-sm text-gray-600" }
          Enrich matched text and propose safe replacement targets.

    %ul{ class: "text-sm text-gray-700 space-y-2" }
      %li.flex.gap-2
        %span{ class: "mt-1 h-2 w-2 rounded-full bg-gray-300 inline-block" }
        %span Normalize and fingerprint lexemes
      %li.flex.gap-2
        %span{ class: "mt-1 h-2 w-2 rounded-full bg-gray-300 inline-block" }
        %span Customized processing (LLM or scripts)
      %li.flex.gap-2
        %span{ class: "mt-1 h-2 w-2 rounded-full bg-gray-300 inline-block" }
        %span Create replacement targets for each context

    %div{ class: "flex gap-2" }
      %a{ href: "#", class: "inline-flex items-center rounded-xl bg-gray-900 px-4 py-2 text-sm font-medium text-white hover:bg-black" } Run Processing
      %a{ href: "#", class: "inline-flex items-center rounded-xl border px-4 py-2 text-sm hover:bg-gray-50" } Processed Lexemes

  .rounded-2xl.border.bg-white.p-6.shadow-sm.space-y-4
    %div{ class: "flex items-start justify-between" }
      %div
        %h3{ class: "text-lg font-semibold" } 3) Review (Human Approval)
        %br
        %p{ class: "text-sm text-gray-600" }
          Review diffs one-by-one and apply reversible changes.

    %ul{ class: "text-sm text-gray-700 space-y-2" }
      %li.flex.gap-2
        %span{ class: "mt-1 h-2 w-2 rounded-full bg-gray-300 inline-block" }
        %span Render contextual diffs (red → green)
      %li.flex.gap-2
        %span{ class: "mt-1 h-2 w-2 rounded-full bg-gray-300 inline-block" }
        %span Approve, ignore, or reject with reason
      %li.flex.gap-2
        %span{ class: "mt-1 h-2 w-2 rounded-full bg-gray-300 inline-block" }
        %span Record actions for audit and rollback

    %div{ class: "flex gap-2" }
      %a{ href: "#", class: "inline-flex items-center rounded-xl bg-gray-900 px-4 py-2 text-sm font-medium text-white hover:bg-black" } Start Review
      %a{ href: "#", class: "inline-flex items-center rounded-xl border px-4 py-2 text-sm hover:bg-gray-50" } Applied Actions

/ Two-column section: Recent activity + Queue
%section{ class: "grid grid-cols-1 lg:grid-cols-2 gap-4" }
  .rounded-2xl.border.bg-white.p-6.shadow-sm
    %div{ class: "flex items-center justify-between" }
      %h3{ class: "text-lg font-semibold" } Recent scan runs
      %a{ href: "#", class: "text-sm text-gray-600 hover:text-gray-900" } View all

    %div{ class: "mt-4 overflow-hidden rounded-xl border" }
      %table{ class: "w-full text-sm" }
        %thead{ class: "bg-gray-50 text-gray-600" }
          %tr
            %th{ class: "px-4 py-3 text-left font-medium" } Status
            %th{ class: "px-4 py-3 text-left font-medium" } Pattern
            %th{ class: "px-4 py-3 text-left font-medium" } File
            %th{ class: "px-4 py-3 text-left font-medium" } Started
        %tbody{ class: "divide-y" }
          -# Static sample rows
          %tr
            %td{ class: "px-4 py-3" }
              %span{ class: "inline-flex items-center rounded-lg border bg-green-50 text-green-700 border-green-200 px-2 py-1 text-xs" } finished
            %td{ class: "px-4 py-3 font-mono text-xs text-gray-900" } zh_strings_in_haml
            %td{ class: "px-4 py-3 font-mono text-xs text-gray-900" } app/views/projects/show.html.haml
            %td{ class: "px-4 py-3 text-gray-600" } 2m ago
          %tr
            %td{ class: "px-4 py-3" }
              %span{ class: "inline-flex items-center rounded-lg border bg-amber-50 text-amber-700 border-amber-200 px-2 py-1 text-xs" } running
            %td{ class: "px-4 py-3 font-mono text-xs text-gray-900" } hardcoded_errors
            %td{ class: "px-4 py-3 font-mono text-xs text-gray-900" } app/models/project.rb
            %td{ class: "px-4 py-3 text-gray-600" } just now
          %tr
            %td{ class: "px-4 py-3" }
              %span{ class: "inline-flex items-center rounded-lg border bg-red-50 text-red-700 border-red-200 px-2 py-1 text-xs" } failed
            %td{ class: "px-4 py-3 font-mono text-xs text-gray-900" } erb_interpolations
            %td{ class: "px-4 py-3 font-mono text-xs text-gray-900" } app/views/shared/_form.html.erb
            %td{ class: "px-4 py-3 text-gray-600" } 1h ago

  .rounded-2xl.border.bg-white.p-6.shadow-sm
    %div{ class: "flex items-center justify-between" }
      %h3{ class: "text-lg font-semibold" } Review queue
      %a{ href: "#", class: "text-sm text-gray-600 hover:text-gray-900" } Go to Review

    %div{ class: "mt-4 space-y-3" }
      -# Static sample items
      .rounded-xl.border.bg-gray-50.p-4
        .flex.items-start.justify-between.gap-3
          %div
            %div{ class: "text-sm font-medium text-gray-900" } Unreviewed occurrence
            %div{ class: "mt-1 text-xs text-gray-600 font-mono break-all" } app/views/projects/show.html.haml:88
          %span{ class: "text-xs px-2 py-1 rounded-lg border bg-white text-gray-700" } unreviewed
        %div{ class: "mt-3 text-xs text-gray-700" }
          %span{ class: "font-mono bg-white border rounded-lg px-2 py-1" } "项目名称不能为空"
          %span{ class: "text-gray-500" } → propose i18n key

      .rounded-xl.border.bg-gray-50.p-4
        .flex.items-start.justify-between.gap-3
          %div
            %div{ class: "text-sm font-medium text-gray-900" } Pending apply
            %div{ class: "mt-1 text-xs text-gray-600 font-mono break-all" } app/models/project.rb:41
          %span{ class: "text-xs px-2 py-1 rounded-lg border bg-white text-gray-700" } approved
        %div{ class: "mt-3 text-xs text-gray-700" }
          %span{ class: "font-mono bg-white border rounded-lg px-2 py-1" } "创建失败"
          %span{ class: "text-gray-500" } → I18n.t("errors.project_create_failed")

-# / Footer note
%section{ class: "rounded-2xl border bg-white p-6 shadow-sm" }
  %h3{ class: "text-lg font-semibold" } Safety model
  %p{ class: "mt-2 text-sm text-gray-600 max-w-4xl" }
    Every replacement is audited and reversible. Occurrence is the smallest unit of review. Apply actions record the original fragment,
    patched fragment, and base file hash to detect drift and support rollback.