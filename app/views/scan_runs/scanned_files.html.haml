-# app/views/scan_runs/scanned_files.html.haml

%div{ class: "h-screen overflow-hidden" }
  %div#scan_run_files_panel{
    class: "flex flex-col h-full overflow-hidden rounded-2xl bg-white shadow-sm"
  }
    -# ===== Fixed Header (NOT scroll) =====
    %div{ class: "bg-indigo-100 text-gray-600 px-4 py-3 border-b border-gray-200" }
      %div{ class: "flex items-center justify-between gap-3" }
        %div{ class: "flex flex-col items-start text-left leading-tight min-w-0" }
          = "\##{@scan_run.id} Scanned Files"

        %div{ class: "shrink-0" }
          = link_to scan_runs_path(repository_id: @selected_id),
            class: "icon-button",
            data: tooltip_data(tip: "Back") do
            = svg_icon("arrow-uturn-left", class_name: "w-6 h-6")

    -# ===== Scroll area: ONLY table body scrolls =====
    - if @scan_run_files.blank?
      %div{ class: "flex-1 overflow-y-auto" }
        %div{ class: "p-6 text-gray-700" } No scanned files found.
    - else
      %div#scan_run_files_body_scroll{ class: "flex-1 overflow-y-auto" }
        %table#scan_run_files_table{ class: "w-full text-sm table-fixed" }
          %tbody{ class: "divide-y divide-gray-300" }
            - @scan_run_files.each do |scan_run_file|
              %tr{ class: "hover:bg-indigo-50/60 transition" }
                %td{ class: "px-4 py-3" }
                  %div{ class: "grid grid-cols-12 gap-3 text-sm" }
                    %div{ class: "col-span-9 font-mono text-xs text-gray-800 break-all" }
                      = scan_run_file.repository_file&.path.to_s
                    %div{ class: "col-span-3 text-right font-mono text-xs text-gray-700" }
                      = scan_run_file.status.to_s

    -# ===== Fixed Footer Pagination =====
    %div{
      class: "flex justify-center items-center gap-2 p-4 bg-white border-t border-gray-200"
    }
      = render "shared/pagination",
        collection: @scan_run_files,
        options: { scan_run_id: @scan_run.id, repository_id: params[:repository_id] }.compact