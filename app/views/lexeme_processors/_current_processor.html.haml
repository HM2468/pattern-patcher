-# app/views/lexeme_processors/_current_processor.html.haml
-# Left sidebar card: Current Processor

= turbo_frame_tag "current_processor" do
  - processor = @current_processor
  - process_count = processor&.process_runs&.count || 0
  - confirm_html = "Start process all <strong>pending</strong> lexemes now."

  %div{ class: "rounded-2xl border border-indigo-200 overflow-hidden" }
    %div{ class: "bg-indigo-100 px-4 py-3 flex items-start justify-between gap-3" }
      %div{ class: "min-w-0" }
        %div{ class: "text-sm font-semibold text-gray-900 truncate" }
          Current Processor
      -if processor.present?
        %div{ class: "shrink-0 flex items-center gap-2" }
          = link_to lexeme_processors_path,
            class: "icon-button",
            data: tooltip_data(tip: "All processors", turbo_frame: "processor_right") do
            = svg_icon("ellipsis-horizontal-circle", class_name: "w-6 h-6")

          = button_to process_runs_path,
            method: :post,
            params: { lexeme_processor_id: processor.id },
            form: { class: "inline-flex" },
            class: "icon-button",
            onclick: "return window.PopConfirmLog.open(event, this)",
            data: start_action_tip(tip: 'Star processing now', title: 'Process lexemes', msg_html: confirm_html) do
            = svg_icon("play", class_name: "w-6 h-6")

    - if processor.nil?
      %div{ class: "px-2 py-2 space-y-2" }
        %div{ class: "text-center text-sm text-gray-600" }
          Select or create a processor first.
        %div{ class: "flex items-center justify-center" }
          = link_to lexeme_processors_path,
            class: "icon-button",
            data: tooltip_data(tip: "All processors", turbo_frame: "processor_right") do
            = svg_icon("chevron-right", class_name: "w-6 h-6")
    - else
      %div{ class: "px-2 py-2 space-y-2" }
        - name_text = processor&.name.presence || "—"
        %div.repo-meta-block
          %div.repo-meta-label name
          %div.repo-meta-value{ title: name_text }
            = name_text
        - entrypoint_text = processor&.entrypoint.presence || "—"
        %div.repo-meta-block
          %div.repo-meta-label Entrupoint
          %div.repo-meta-value{ title: entrypoint_text }
            = entrypoint_text

        %div.repo-meta-block
          %div.repo-meta-label Process Runs
          %div.repo-meta-value{ title: process_count }
            = link_to process_runs_path(processor_id: processor&.id),
              data: { turbo_frame: "processor_right" },
              class: "repo-stat-card" do
              %div.repo-stat-value
                %span{ id: dom_id(processor, :process_count) }
                  = process_count