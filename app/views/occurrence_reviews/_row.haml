-# app/views/occurence_revies/_row.html.haml
-# locals: occ_rev

- ignored = (occ_rev.status.to_s == "ignored")
- eye_class = ignored ? "text-gray-700 hover:text-indigo-700" : "text-gray-300 hover:text-indigo-500"
- row_height = "h-14"

%tr{
  id: dom_id(occ_rev),
  class: "group bg-white transition hover:bg-indigo-50/60 focus-within:bg-indigo-50/60 #{row_height}"
}
  %td{ class: "w-[10%] px-4 py-0.5 align-middle" }
    %div{ class: "h-full flex flex-col items-center justify-center text-center leading-tight" }
      %div{ class: "font-mono text-xs text-gray-800" }= occ_rev.id
      - badge_class = 'bg-indigo-50 text-indigo-700 border-indigo-200'
      %span{ class: "mt-1 inline-flex items-center rounded-full border px-2 py-0.5 text-[10px] #{badge_class}" }
        = occ_rev.status.presence || "unknown"

  %td{ class: "w-[50%] px-4 py-0.5 align-middle" }
    %div{ class: "h-full flex flex-col justify-center text-left leading-tight gap-1" }
      %div{
        class: "w-full text-xs font-mono text-blue-800 truncate"
      }
        = occ_rev.occurrence.matched_text
      %div{
        class: "w-full text-xs font-mono text-green-800 truncate"
      }
        = occ_rev.rendered_code

  %td{ class: "w-[30%] px-4 py-0.5 align-middle" }
    %div{ class: "h-full flex items-center" }
      %div{ class: "w-full font-mono text-[10px] text-blue-800 truncate" }
        = occ_rev.occurrence.repository_file.path

  %td{ class: "w-[10%] px-4 py-0.5 align-middle" }
    %div{ class: "h-full flex items-center justify-center" }
      %div{ class: "flex items-center gap-2" }
        = button_to '',
          method: :patch,
          params: { page: params[:page], status: params[:status] },
          form: { class: "inline-flex" },
          class: "icon-button",
          data: tooltip_data(tip: ignored ? "Unignore (set to pending)" : "Ignore") do
          = svg_icon("eye-slash", class_name: "w-5 h-5 #{eye_class}")

        = button_to occurrence_review_path(occ_rev),
          method: :delete,
          params: { page: params[:page], status: params[:status] },
          form: { class: "inline-flex" },
          class: "icon-button",
          onclick: "return window.PopConfirmLog.open(event, this)",
          data: delete_tip(title: "Delete occ_rev", msg: "Delete this occ_rev? This cannot be undone.") do
          = svg_icon("trash", class_name: "w-5 h-5")