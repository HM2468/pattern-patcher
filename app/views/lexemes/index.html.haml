-# frozen_string_literal: true
-# app/views/lexemes/index.html.haml
-# Lexemes index
-# Fixed header + scrollable body + fixed pagination (like lexical_patterns/index)

%div{ class: "h-full overflow-hidden" }
  %div#lexemes_panel{
    class: "flex flex-col h-full overflow-hidden rounded-2xl"
  }

    -# ===== Fixed Header (NOT scroll) =====
    %div{ class: "bg-indigo-100 text-gray-600 border-b border-gray-100 mx-5 rounded-2xl" }
      %div{ class: "px-6 py-3 flex items-center justify-left gap-3" }
        %div{ class: "flex flex-col items-start text-left leading-tight min-w-0" }
          %div{ class: "text-lg font-semibold text-gray-900" }
            = "Lexemes(#{@status || 'all'})"

        = link_to lexemes_path(status: 'pending'),
          class: "inline-flex items-center gap-2 rounded-md bg-white px-2.5 py-1 font-mono text-xs text-gray-800 shadow-sm ring-1 ring-gray-200 hover:bg-gray-50 hover:ring-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500",
          title: "New review rows (OccurrenceReviewResult)",
          data: { turbo_prefetch: false } do
          %span Pending:
          %span{ class: "font-mono" }= @pending_count
          %span{ class: "text-indigo-400" }= svg_icon("arrow-uturn-right", class_name: "w-4 h-4")

        = link_to lexemes_path(status: 'processed'),
          class: "inline-flex items-center gap-2 rounded-md bg-white px-2.5 py-1 font-mono text-xs text-gray-800 shadow-sm ring-1 ring-gray-200 hover:bg-gray-50 hover:ring-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500",
          title: "New review rows (OccurrenceReviewResult)",
          data: { turbo_prefetch: false } do
          %span Processed:
          %span{ class: "font-mono" }= @processed_count
          %span{ class: "text-indigo-400" }= svg_icon("arrow-uturn-right", class_name: "w-4 h-4")

        = link_to lexemes_path(status: 'ignored'),
          class: "inline-flex items-center gap-2 rounded-md bg-white px-2.5 py-1 font-mono text-xs text-gray-800 shadow-sm ring-1 ring-gray-200 hover:bg-gray-50 hover:ring-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500",
          title: "New review rows (OccurrenceReviewResult)",
          data: { turbo_prefetch: false } do
          %span Ignored:
          %span{ class: "font-mono" }= @ignored_count
          %span{ class: "text-indigo-400" }= svg_icon("arrow-uturn-right", class_name: "w-4 h-4")

    -# ===== Scroll area: ONLY body scrolls =====
    %div#lexemes_body_scroll{ class: "pp-scroll-gutter-stable flex-1 overflow-y-auto" }
      %div{ class: "px-6 py-4 space-y-4" }

        - if !defined?(@lexemes) || @lexemes.blank?
          %div#lexemes_empty_state
            .rounded-2xl.bg-gray-50.p-8.shadow-sm
              %div{ class: "text-sm text-gray-600" }
                No lexemes found.
        - else
          .rounded-2xl.bg-white.shadow-sm.overflow-hidden
            %table{ class: "w-full table-fixed text-sm" }
              %tbody{ id: "lexemes_tbody", class: "divide-y divide-gray-300" }
                - @lexemes.each do |lexeme|
                  = render "row", lexeme: lexeme

    -# ===== Fixed Footer Pagination =====
    %div{ class: "sticky bottom-0" }
      - if defined?(@lexemes) && @lexemes.respond_to?(:current_page) && @lexemes.any?
        = render "shared/pagination", collection: @lexemes