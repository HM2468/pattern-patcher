-# app/views/lexemes/_row.html.haml
-# locals: lexeme

- source_text = lexeme.source_text.to_s
- meta_obj = lexeme.metadata
- meta_text = meta_obj.is_a?(String) ? meta_obj : meta_obj.to_json
- ignored = (lexeme.process_status.to_s == "ignored")
- eye_class = ignored ? "text-gray-700 hover:text-indigo-700" : "text-gray-300 hover:text-indigo-500"
- row_height = "h-16" # 固定行高，可按需改成 h-18 / h-20

%tr{
  id: dom_id(lexeme),
  class: "group bg-white transition hover:bg-indigo-50/60 focus-within:bg-indigo-50/60 #{row_height}"
}
  -# 1) ID列 10%：ID在上、status在下，居中排列
  %td{ class: "w-[10%] px-4 py-3 align-middle" }
    %div{ class: "h-full flex flex-col items-center justify-center text-center leading-tight" }
      %div{ class: "font-mono text-xs text-gray-800" }= lexeme.id
      - badge_class = process_status_badge_class(lexeme)
      %span{ class: "mt-1 inline-flex items-center rounded-full border px-2 py-0.5 text-[11px] #{badge_class}" }
        = lexeme.process_status.presence || "unknown"

  -# 2) Source Text 50%：自动换行 + 固定高度内裁剪 + hover title 展示完整
  %td{ class: "w-[50%] px-4 py-3 align-middle" }
    %div{
      class: "h-full flex items-center",
      title: source_text
    }
      %div{ class: "w-full text-xs font-mono text-gray-800 whitespace-pre-wrap break-words overflow-hidden max-h-12" }
        = source_text

  -# 3) Metadata 30%：自动换行 + 固定高度内裁剪 + hover title 展示完整
  %td{ class: "w-[30%] px-4 py-3 align-middle" }
    %div{
      class: "h-full flex items-center",
      title: meta_text
    }
      %div{ class: "w-full font-mono text-[11px] text-gray-600 whitespace-pre-wrap break-words overflow-hidden max-h-12" }
        = meta_text

  -# 4) Actions列 10%：两个 icon，eye-slash 左，trash 右；垂直居中
  %td{ class: "w-[10%] px-4 py-3 align-middle" }
    %div{ class: "h-full flex items-center justify-center" }
      %div{ class: "flex items-center gap-2" }

        -# 7) 点击 eye-slash 在 pending/ignored 间切换
        = button_to toggle_ignore_lexeme_path(lexeme),
          method: :patch,
          params: { page: params[:page], status: params[:status] },
          form: { class: "inline-flex" },
          class: "icon-button",
          data: tooltip_data(tip: ignored ? "Unignore (set to pending)" : "Ignore") do
          = svg_icon("eye-slash", class_name: "w-5 h-5 #{eye_class}")

        = button_to lexeme_path(lexeme),
          method: :delete,
          params: { page: params[:page], status: params[:status] },
          form: { class: "inline-flex" },
          class: "icon-button",
          onclick: "return window.PopConfirmLog.open(event, this)",
          data: delete_tip(title: "Delete Lexeme", msg: "Delete this lexeme? This cannot be undone.") do
          = svg_icon("trash", class_name: "w-5 h-5")