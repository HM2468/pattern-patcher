-# app/views/lexical_patterns/index.html.haml
-# Lexical Patterns index
-# Shows: Name / Type / Enabled toggle / Priority / Actions
-# Turbo delete (fill-the-gap): tbody/pagination/empty are wrapped with stable DOM ids

%main{ class: "mx-auto max-w-6xl px-6 py-8 space-y-6" }
  %div{ class: "flex items-start justify-between gap-4" }
    %div
      %h2{ class: "text-2xl font-semibold tracking-tight" } Lexical Patterns
      %p{ class: "mt-1 text-sm text-gray-600" }
        Patterns are executed in priority order. Lower priority number runs first.

    %div{ class: "flex gap-2" }
      = link_to "New Pattern", new_lexical_pattern_path,
        class: "inline-flex items-center rounded-xl bg-gray-900 px-4 py-2 text-sm font-medium text-white hover:bg-black"

  .rounded-2xl.bg-white.shadow-sm.overflow-hidden
    %table{ class: "w-full text-sm" }
      %thead{ class: "bg-gray-300 text-gray-600" }
        %tr
          %th{ class: "px-4 py-3 text-left font-medium" } Name
          %th{ class: "px-4 py-3 text-left font-medium" } Type
          %th{ class: "px-4 py-3 text-left font-medium" } Enabled
          %th{ class: "px-4 py-3 text-left font-medium" } Priority
          %th{ class: "px-4 py-3 text-left font-medium" } Actions

      -# IMPORTANT: stable tbody id so Turbo can replace it to fill the gap after delete
      %tbody{ id: "lexical_patterns_tbody", class: "divide-y" }
        - @lexical_patterns.each do |pattern|
          = render "row", pattern: pattern

  -# IMPORTANT: stable empty state container (Turbo replace)
  %div{ id: "lexical_patterns_empty_state" }
    - if @lexical_patterns.empty?
      .rounded-2xl.bg-gray-50.p-8.shadow-sm
        %div{ class: "text-sm text-gray-600" }
          No patterns yet. Create your first pattern to start scanning.

  -# IMPORTANT: stable pagination container (Turbo replace)
  %div{ id: "lexical_patterns_pagination" }
    - if @lexical_patterns.any? && @lexical_patterns.total_pages > 1
      = render "shared/pagination", collection: @lexical_patterns