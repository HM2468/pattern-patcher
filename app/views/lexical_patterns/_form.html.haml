-# app/views/lexical_patterns/_form.html.haml

= form_with(model: @lexical_pattern, class: "rounded-2xl bg-gray-50 p-4 shadow-sm", data: { turbo: false }) do |form|
  - if @lexical_pattern.errors.any?
    %div{ class: "form-errors" }
      %h3{ class: "form-errors__title" }
        = pluralize(@lexical_pattern.errors.count, "error")
        prohibited this pattern from being saved:
      %ul{ class: "form-errors__list" }
        - @lexical_pattern.errors.each do |error|
          %li{ class: "form-errors__item" }
            %span{ class: "form-errors__dot" }
            %span= error.full_message

  %div{ class: "p-6" }
    %div{ class: "space-y-4" }

      / Pattern
      %div
        %label{ for: "lexical_pattern_pattern", class: "block text-sm font-medium text-gray-700 mb-1" }
          Pattern (Regex)
        = form.text_area :pattern,
          id: "lexical_pattern_pattern",
          class: "form-textarea",
          rows: 3,
          placeholder: "e.g., /\"[^\"]+\"/",
          required: true

      / Name + Language
      %div{ class: "grid grid-cols-1 md:grid-cols-2 gap-4" }
        %div
          %label{ for: "lexical_pattern_name", class: "block text-sm font-medium text-gray-700 mb-1" }
            Name
          = form.text_field :name,
            id: "lexical_pattern_name",
            class: "form-input",
            placeholder: "e.g., hardcoded_strings",
            required: true

        %div
          %label{ for: "lexical_pattern_language", class: "block text-sm font-medium text-gray-700 mb-1" }
            Language
          = form.text_field :language,
            id: "lexical_pattern_language",
            class: "form-input",
            placeholder: "e.g., ruby/erb/haml/js/tsx",
            required: true

      / Mode + Priority
      %div{ class: "grid grid-cols-1 md:grid-cols-2 gap-4" }
        %div
          %label{ for: "lexical_pattern_mode", class: "block text-sm font-medium text-gray-700 mb-1" }
            Mode
          = form.select :scan_mode,
            ['line_mode', 'file_mode'],
            { selected: @lexical_pattern&.scan_mode || "line_mode" },
            { id: "lexical_pattern_mode", class: "form-select", required: true }

      / Enabled
      %div{ class: "flex items-center gap-2" }
        = form.check_box :enabled,
          id: "lexical_pattern_enabled",
          class: "h-4 w-4 rounded border-indigo-200 text-indigo-600 focus:ring-indigo-400"
        %label{ for: "lexical_pattern_enabled", class: "text-sm font-medium text-gray-700" }
          Enabled

  / Actions
  %div{ class: "flex items-center justify-end gap-4" }
    = link_to "Cancel", lexical_patterns_path, class: "button-secondary"
    = form.submit "Save", class: "button-primary"