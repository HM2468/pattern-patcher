-# app/views/lexical_patterns/_form.html.haml

= form_with(model: @lexical_pattern, class: "rounded-2xl bg-gray-50 p-4 shadow-sm", data: { turbo: false }) do |form|
  - if @lexical_pattern.errors.any?
    %div{ class: "rounded-2xl border border-red-200 bg-red-50 p-4" }
      %h3{ class: "text-sm font-semibold text-red-800" }
        = pluralize(@lexical_pattern.errors.count, "error")
        prohibited this pattern from being saved:
      %ul{ class: "mt-2 space-y-1 text-sm text-red-700" }
        - @lexical_pattern.errors.each do |error|
          %li{ class: "flex items-start gap-2" }
            %span{ class: "h-1.5 w-1.5 mt-1.5 flex-shrink-0 rounded-full bg-red-500" }
            %span= error.full_message

  %div{ class: "p-6" }
    %div{ class: "space-y-4" }

      / Pattern
      %div
        %label{ for: "lexical_pattern_pattern", class: "block text-sm font-medium text-gray-700 mb-1" }
          Pattern (Regex)
        = form.text_area :pattern,
          id: "lexical_pattern_pattern",
          class: "form-textarea",
          rows: 3,
          placeholder: "e.g., /\"[^\"]+\"/",
          required: true

      / Name + Language
      %div{ class: "grid grid-cols-1 md:grid-cols-2 gap-4" }
        %div
          %label{ for: "lexical_pattern_name", class: "block text-sm font-medium text-gray-700 mb-1" }
            Name
          = form.text_field :name,
            id: "lexical_pattern_name",
            class: "form-input",
            placeholder: "e.g., hardcoded_strings",
            required: true

        %div
          %label{ for: "lexical_pattern_language", class: "block text-sm font-medium text-gray-700 mb-1" }
            Language
          = form.text_field :language,
            id: "lexical_pattern_language",
            class: "form-input",
            placeholder: "e.g., ruby/erb/haml/js/tsx",
            required: true

      / Mode + Priority
      %div{ class: "grid grid-cols-1 md:grid-cols-2 gap-4" }
        %div
          %label{ for: "lexical_pattern_mode", class: "block text-sm font-medium text-gray-700 mb-1" }
            Mode
          = form.select :mode,
            LexicalPattern::MODES,
            { selected: @lexical_pattern.mode || "line" },
            { id: "lexical_pattern_mode", class: "form-select", required: true }

        %div
          %label{ for: "lexical_pattern_priority", class: "block text-sm font-medium text-gray-700 mb-1" }
            Priority
          = form.number_field :priority,
            id: "lexical_pattern_priority",
            class: "form-input",
            min: 1,
            max: 1000,
            required: true
          %p{ class: "mt-1 text-xs text-gray-500" }
            Must be between 1 and 1000 (inclusive)

      / Enabled
      %div{ class: "flex items-center gap-2" }
        = form.check_box :enabled,
          id: "lexical_pattern_enabled",
          class: "h-4 w-4 rounded border-indigo-200 text-indigo-600 focus:ring-indigo-400"
        %label{ for: "lexical_pattern_enabled", class: "text-sm font-medium text-gray-700" }
          Enabled

  / Actions
  %div{ class: "flex items-center justify-end gap-4" }
    = link_to "Cancel", lexical_patterns_path, class: "button-secondary"
    = form.submit "Save", class: "button-primary"